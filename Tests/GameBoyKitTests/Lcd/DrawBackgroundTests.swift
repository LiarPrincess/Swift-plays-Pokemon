// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.

import XCTest
@testable import GameBoyKit

// swiftlint:disable line_length
// swiftlint:disable function_body_length

class DrawBackgroundTests: LcdTestCase {

  // MARK: - Nintendo

  func test_nintendoLogo() {
    let lcd = self.createLcdWithNintendoLogo()
    let lines = self.drawFramebuffer(lcd: lcd,
                                     isBackgroundVisible: true,
                                     isWindowEnabled: false,
                                     isSpriteEnabled: false)

    let logoStart = 64
    let logoEnd = 79
    let logo = [
      "                                3333      3333  3333                                                          3333                3333                          ",
      "                                3333      3333  3333                                                          3333               3    3                         ",
      "                                333333    3333  3333                3333                                      3333              3 333  3                        ",
      "                                333333    3333  3333                3333                                      3333              3 3  3 3                        ",
      "                                333333    3333                    33333333                                    3333              3 333  3                        ",
      "                                333333    3333                    33333333                                    3333              3 3  3 3                        ",
      "                                3333  33  3333  3333  3333  3333    3333    33333333    3333  3333      3333333333    33333333   3    3                         ",
      "                                3333  33  3333  3333  3333  3333    3333    33333333    3333  3333      3333333333    33333333    3333                          ",
      "                                3333  33  3333  3333  333333  3333  3333  3333    3333  333333  3333  3333    3333  3333    3333                                ",
      "                                3333  33  3333  3333  333333  3333  3333  3333    3333  333333  3333  3333    3333  3333    3333                                ",
      "                                3333    333333  3333  3333    3333  3333  333333333333  3333    3333  3333    3333  3333    3333                                ",
      "                                3333    333333  3333  3333    3333  3333  333333333333  3333    3333  3333    3333  3333    3333                                ",
      "                                3333    333333  3333  3333    3333  3333  3333          3333    3333  3333    3333  3333    3333                                ",
      "                                3333    333333  3333  3333    3333  3333  3333          3333    3333  3333    3333  3333    3333                                ",
      "                                3333      3333  3333  3333    3333  3333    3333333333  3333    3333    3333333333    33333333                                  ",
      "                                3333      3333  3333  3333    3333  3333    3333333333  3333    3333    3333333333    33333333                                  "
    ]

    for (index, line) in lines.enumerated() {
      let isNintendoLogo = logoStart <= index && index <= logoEnd
      let expected = isNintendoLogo ? logo[index - logoStart] : emptyLine
      XCTAssertEqual(line, expected, "Index: \(index) (isNintendoLogo: \(isNintendoLogo))")
    }
  }

  // MARK: - Tetris

  func test_tetris() {
    let lcd = self.createLcdWithTetris()
    let lines = self.drawFramebuffer(lcd: lcd,
                                     isBackgroundVisible: true,
                                     isWindowEnabled: false,
                                     isSpriteEnabled: false)

    let expected = [
      "3333333 13 113 1                                                                                13 113 1 3333333333333333333333333333333333333333333333333333333",
      "3333333 13111311                                                                                13111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                                                 113 113 3333333333333333333333333333333333333333333333333333333",
      "3333333 11131113                                                                                11131113 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 33333                                            333333",
      "3333333 13 113 1                                                                                13 113 1 3333  222222222222222222222222222222222222222222  33333",
      "3333333 13111311                                                                                13111311 3333 22                                        22 33333",
      "3333333 33333333                                                                                33333333 3333 2                                          2 33333",
      "3333333  113 113                                                                                 113 113 3333 2   3333    3333    3333   33333   333333  2 33333",
      "3333333 11131113                                                                                11131113 3333 2  33      33  33  33  33  33  33  33      2 33333",
      "3333333 33333333                                                                                33333333 3333 2   3333   33      33  33  33  33  33333   2 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2     333  33      33  33  33333   33      2 33333",
      "3333333 13111311                                                                                13111311      2  3  333  33  33  33  33  33 3    33      2      ",
      "3333333 33333333                                                                                33333333 2222 2   3333    3333    3333   33  33  333333  2 22222",
      "3333333  113 113                                                                                 113 113 2222 2                                          2 22222",
      "3333333 11131113                                                                                11131113 2222 22                                        22 22222",
      "3333333 33333333                                                                                33333333 2222  222222222222222222222222222222222222222222  22222",
      "3333333 13 113 1                                                                                13 113 1 22222                                            222222",
      "3333333 13111311                                                                                13111311 2222222222222222222222222222222222222222222222222222222",
      "3333333 33333333                                                                                33333333 2222222222222222222222222222222222222222222222222222222",
      "3333333  113 113                                                                                 113 113                                                        ",
      "3333333 11131113                                                                                11131113 2222222222222222222222222222222222222222222222222222222",
      "3333333 33333333                                                                                33333333                                                        ",
      "3333333 13 113 1                                                                                13 113 1                                                        ",
      "3333333 13111311                                                                                13111311                                  3333    3333          ",
      "3333333 33333333                                                                                33333333                                 33 33   33  33         ",
      "3333333  113 113                                                                                 113 113                                 3  33   33  33         ",
      "3333333 11131113                                                                                11131113                                 3  333  33  33         ",
      "3333333 33333333                                                                                33333333                                 333333  33  33         ",
      "3333333 13 113 1                                                                                13 113 1                                    33    3333          ",
      "3333333 13111311                                                                                13111311                                                        ",
      "3333333 33333333                                                                                33333333                                                        ",
      "3333333  113 113                                                                                 113 113 2222222222222222222222222222222222222222222222222222222",
      "3333333 11131113                                                                                11131113                                                        ",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333 13 113 1                                                                                13 113 1 3333333333333333333333333333333333333333333333333333333",
      "3333333 13111311                                                                                13111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                                                 113 113 3333333333333333333333333333333333333333333333333333333",
      "3333333 11131113                                                                                11131113 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333 13 113 1                                                                                13 113 1 3333333333333333333333333333333333333333333333333333333",
      "3333333 13111311                                                                                13111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                                                 113 113 33333                                            333333",
      "3333333 11131113                                                                                11131113 3333  222222222222222222222222222222222222222222  33333",
      "3333333 33333333                                                                                33333333 3333 22                                        22 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2                                          2 33333",
      "3333333 13111311                                                                                13111311 3333 2  33      333333  3   33  333333  33      2 33333",
      "3333333 33333333                                                                                33333333 3333 2  33      33      3   33  33      33      2 33333",
      "3333333  113 113                                                                                 113 113 3333 2  33      33333   3   33  33333   33      2 33333",
      "3333333 11131113                                                                                11131113 3333 2  33      33      3   33  33      33      2 33333",
      "3333333 33333333                                                                                33333333 3333 2  33      33       3 33   33      33      2 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2  333333  333333    33    333333  333333  2 33333",
      "3333333 13111311                                                                                13111311 3333 2                                          2 33333",
      "3333333 33333333                                                                                33333333 3333 2                                          2 33333",
      "3333333  113 113                                                                                 113 113 3333 2                          333333          2 33333",
      "3333333 11131113                                                                                11131113 3333 2                              33          2 33333",
      "3333333 33333333                                                                                33333333 3333 2                             33           2 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2                            33            2 33333",
      "3333333 13111311                                                                                13111311 3333 2                           333            2 33333",
      "3333333 33333333                                                                                33333333 3333 2                           333            2 33333",
      "3333333  113 113                                                                                 113 113 3333 2                                          2 33333",
      "3333333 11131113                                                                                11131113 3333 22                                        22 33333",
      "3333333 33333333                                                                                33333333 3333  222222222222222222222222222222222222222222  33333",
      "3333333 13 113 1                                                                                13 113 1 33333                                            333333",
      "3333333 13111311                                                                                13111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                                                 113 113 33333                                            333333",
      "3333333 11131113                                                                                11131113 3333  222222222222222222222222222222222222222222  33333",
      "3333333 33333333                                                                                33333333 3333 22                                        22 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2                                          2 33333",
      "3333333 13111311                                                                                13111311 3333 2  33       3333   3   33  333333   3333   2 33333",
      "3333333 33333333                                                                                33333333 3333 2  33        33    33  33  33      33      2 33333",
      "3333333  113 113                                                                                 113 113 3333 2  33        33    333 33  33333    3333   2 33333",
      "3333333 11131113                                                                                11131113 3333 2  33        33    3 3333  33         333  2 33333",
      "3333333 33333333                                                                                33333333 3333 2  33        33    3  333  33      3  333  2 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2  333333   3333   3   33  333333   3333   2 33333",
      "3333333 13111311                                                                                13111311 3333 2                                          2 33333",
      "3333333 33333333                                                                                33333333 3333 2                                          2 33333",
      "3333333  113 113                                                                                 113 113 3333 2                           3333           2 33333",
      "3333333 11131113                                                                                11131113 3333 2                          33  33          2 33333",
      "3333333 33333333                                                                                33333333 3333 2                          33  33          2 33333",
      "3333333 13 113 1                                                                                13 113 1 3333 2                          33  33          2 33333",
      "3333333 13111311                                                                                13111311 3333 2                          33  33          2 33333",
      "3333333 33333333                                                                                33333333 3333 2                           3333           2 33333",
      "3333333  113 113                                                                                 113 113 3333 2                                          2 33333",
      "3333333 11131113                                                                                11131113 3333 22                                        22 33333",
      "3333333 33333333                                                                                33333333 3333  222222222222222222222222222222222222222222  33333",
      "3333333 13 113 1                                                                                13 113 1 33333                                            333333",
      "3333333 13111311                                                                                13111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                                                 113 113 3333333333333333333333333333333333333333333333333333333",
      "3333333 11131113                                                                                11131113 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                                                33333333 3333333333333333333333333333333333333333333333333333333",
      "3333333 13 113 1                                                        33333333        3333333313 113 1 3333333333333333333333333333333333333333333333333333333",
      "3333333 13111311                                                        31111113        3111111313111311 3333333333333333333333333333333333333333333333333333333",
      "3333333 33333333                                                        31111113        31    1333333333 3333333333333333333333333333333333333333333333333333333",
      "3333333  113 113                                                        31133113        31 11313 113 113 3333333333331111111111111111111111111111111111111133333",
      "3333333 11131113                                                        31133113        31 1131311131113 333333333331                                      13333",
      "3333333 33333333                                                        31111113        3133331333333333 33333333331  122222222222222222222222222222222221  1333",
      "3333333 13 113 1                                                        31111113        3111111313 113 1 33333333331 12333333333333333333333333333333333321 1333",
      "3333333 13111311                                                        33333333        3333333313111311 33333333331 23                                  32 1333",
      "3333333 33333333        3333333333333333                        3333333333333333333333333333333333333333 33333333331 23                                  32 1333",
      "3333333  113 113        3      33      3                        31111113311111133111111331111113 113 113 33333333331 23                                  32 1333",
      "3333333 11131113        3 3333 33 3333 3                        311111133111111331    1331    1311131113 33333333331 23                                  32 1333",
      "3333333 33333333        3 3333 33 3333 3                        311331133113311331 1131331 1131333333333 33333333331 23                                  32 1333",
      "3333333 13 113 1        3 3333 33 3333 3                        311331133113311331 1131331 1131313 113 1 33333333331 23                                  32 1333",
      "3333333 13111311        3 3333 33 3333 3                        3111111331111113313333133133331313111311 33333333331 23                                  32 1333",
      "3333333 33333333        3      33      3                        3111111331111113311111133111111333333333 33333333331 23                                  32 1333",
      "3333333  113 113        3333333333333333                        33333333333333333333333333333333 113 113 33333333331 23                                  32 1333",
      "3333333 11131113333333333333333333333333                        3333333333333333333333333333333311131113 33333333331 23                                  32 1333",
      "3333333 33333333311111133      33      3                        3111111331111113322222233111111333333333 33333333331 23                                  32 1333",
      "3333333 13 113 1313333133 3333 33 3333 3                        31111113311111133233332331    1313 113 1 33333333331 23                                  32 1333",
      "3333333 13111311313  3133 3333 33 3333 3                        3113311331133113323  32331 1131313111311 33333333331 23                                  32 1333",
      "3333333 33333333313  3133 3333 33 3333 3                        3113311331133113323  32331 1131333333333 33333333331 23                                  32 1333",
      "3333333  113 113313333133 3333 33 3333 3                        31111113311111133233332331333313 113 113 33333333331 23                                  32 1333",
      "3333333 11131113311111133      33      3                        3111111331111113322222233111111311131113 33333333331 23                                  32 1333",
      "3333333 33333333333333333333333333333333                        3333333333333333333333333333333333333333 33333333331 23                                  32 1333",
      "3333333 13 113 1333333333333333333333333                        3333333333333333333333333333333313 113 1 33333333331 23                                  32 1333",
      "3333333 13111311311111133111111331111113                        3111111331111113322222233222222313111311 33333333331 23                                  32 1333",
      "3333333 33333333313333133133331331333313                        3111111331111113323333233233332333333333 33333333331 23                                  32 1333",
      "3333333  113 113313  313313  313313  313                        3113311331133113323  323323  323 113 113 33333333331 23                                  32 1333",
      "3333333 11131113313  313313  313313  313                        3113311331133113323  323323  32311131113 33333333331 23                                  32 1333",
      "3333333 33333333313333133133331331333313                        3111111331111113323333233233332333333333 33333333331 23                                  32 1333",
      "3333333 13 113 1311111133111111331111113                        3111111331111113322222233222222313 113 1 33333333331 23                                  32 1333",
      "3333333 13111311333333333333333333333333                        3333333333333333333333333333333313111311 33333333331 23                                  32 1333",
      "3333333 3333333333333333333333333333333333333333        333333333333333333333333333333333333333333333333 33333333331 23                                  32 1333",
      "3333333  113 11331111113311111133111111331111113        3111111331111113311111133111111332222223 113 113 33333333331 23                                  32 1333",
      "3333333 1113111331333313313333133133331331333313        313333133111111331111113311111133233332311131113 33333333331 23                                  32 1333",
      "3333333 33333333313  313313  313313  313313  313        313  313311331133113311331133113323  32333333333 33333333331 23                                  32 1333",
      "3333333 13 113 1313  313313  313313  313313  313        313  313311331133113311331133113323  32313 113 1 33333333331 23                                  32 1333",
      "3333333 1311131131333313313333133133331331333313        313333133111111331111113311111133233332313111311 33333333331 23                                  32 1333",
      "3333333 3333333331111113311111133111111331111113        311111133111111331111113311111133222222333333333 33333333331 23                                  32 1333",
      "3333333  113 11333333333333333333333333333333333        3333333333333333333333333333333333333333 113 113 33333333331 23                                  32 1333",
      "3333333 1113111333333333333333333333333333333333        333333333333333333333333333333333333333311131113 33333333331 23                                  32 1333",
      "3333333 3333333331111113311111133111111331111113        311111133111111331111113311111133111111333333333 33333333331 12333333333333333333333333333333333321 1333",
      "3333333 13 113 131333313313333133133331331333313        313333133133331331333313311111133111111313 113 1 33333333331  122222222222222222222222222222222221  1333",
      "3333333 13111311313  313313  313313  313313  313        313  313313  313313  313311331133113311313111311 333333333331                                      13333",
      "3333333 33333333313  313313  313313  313313  313        313  313313  313313  313311331133113311333333333 3333333333331111111111111111111111111111111111111133333",
      "3333333  113 11331333313313333133133331331333313        3133331331333313313333133111111331111113 113 113 3333333333333333333333333333333333333333333333333333333",
      "3333333 1113111331111113311111133111111331111113        311111133111111331111113311111133111111311131113 3333333333333333333333333333333333333333333333333333333",
      "3333333 3333333333333333333333333333333333333333        333333333333333333333333333333333333333333333333 3333333333333333333333333333333333333333333333333333333"
    ]

    XCTAssertEqual(lines.count, expected.count)
    for (index, (line, expected)) in zip(lines, expected).enumerated() {
      XCTAssertEqual(line, expected, "Index: \(index)")
    }
  }
}
