// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.

import Foundation
import GameBoyKit

// swiftlint:disable collection_alignment

private var programCounters: [String] = [
     "0x3",   "0xfc",   "0xfe",  "0x100",  "0x101",  "0x213",  "0x216",  "0x200",
   "0x201",  "0x204",  "0x206",  "0x207",  "0x208",  "0x209",  "0x20b",  "0x20c",
   "0x20d",  "0x20f",  "0x210", "0xc000", "0xc220", "0xc221", "0xc224", "0xc227",
  "0xc229", "0xc22b", "0xc22d", "0xc22f", "0xc231", "0xc233", "0xc235", "0xc237",
  "0xc239", "0xc23b", "0xc23d", "0xc23f", "0xc241", "0xc243", "0xc246", "0xc093",
  "0xc094", "0xc097", "0xc098", "0xc09b", "0xc0a1", "0xc0a3", "0xc0a6", "0xc249",
  "0xc17e", "0xc17f", "0xc16b", "0xc16c", "0xc16d", "0xc16e", "0xc16f", "0xc170",
  "0xc171", "0xc174", "0xc175", "0xc178", "0xc179", "0xc17c", "0xc17d", "0xc182",
  "0xc186", "0xc187", "0xc04d", "0xc04f", "0xc051", "0xc053", "0xc055", "0xc057",
  "0xc059", "0xc18a", "0xc24c", "0xc79b", "0xc36d", "0xc410", "0xc411", "0xc35c",
  "0xc35d", "0xc360", "0xc361", "0xc362", "0xc363", "0xc365", "0xc367", "0xc369",
  "0xc36b", "0xc36c", "0xc414", "0xc416", "0xc418", "0xc419", "0xc370", "0xc373",
  "0xc375", "0xc378", "0xc37a", "0xc3a1", "0xc3a4", "0xc3a6", "0xc3a7", "0xc3a8",
  "0xc3aa", "0xc3ab", "0xc3ac", "0xc3ae", "0xc37d", "0xc380", "0xc382", "0xc3e8",
  "0xc3eb", "0xc3ed", "0xc3ee", "0xc3f0", "0xc3f1", "0xc3f2", "0xc3f3", "0xc3f4",
  "0xc3f5", "0xc3f6", "0xc3f8", "0xc3f9", "0xc3fa", "0xc3fc", "0xc385", "0xc388",
  "0xc38a", "0xc38d", "0xc38f", "0xc392", "0xc394", "0xc397", "0xc399", "0xc39c",
  "0xc456", "0xc457", "0xc458", "0xc45b", "0xc45d", "0xc460", "0xc462", "0xc465",
  "0xc467", "0xc468", "0xc469", "0xc46b", "0xc46d", "0xc470", "0xc471", "0xc472",
  "0xc39f", "0xc3fd", "0xc3fe", "0xc401", "0xc403", "0xc405", "0xc407", "0xc409",
  "0xc40b", "0xc40d", "0xc47a", "0xc47d", "0xc47f", "0xc481", "0xc482", "0xc79e",
  "0xc79f", "0xc0c2", "0xc0c3", "0xc0c7", "0xc0c8", "0xc0cd", "0xc0ce", "0xc0cf",
  "0xc0ca", "0xc0a7", "0xc0a8", "0xc0aa", "0xc05a", "0xc05b", "0xc05c", "0xc05d",
  "0xc05e", "0xc061", "0xc062", "0xc063", "0xc064", "0xc065", "0xc066", "0xc067",
  "0xc068", "0xc06a", "0xc06c", "0xc06e", "0xc070", "0xc071", "0xc073", "0xc074",
  "0xc075", "0xc077", "0xc078", "0xc079", "0xc07b", "0xc07c", "0xc07d", "0xc07f",
  "0xc080", "0xc081", "0xc083", "0xc084", "0xc086", "0xc088", "0xc089", "0xc08a",
  "0xc08b", "0xc08c", "0xc08d", "0xc08e", "0xc08f", "0xc090", "0xc091", "0xc092",
  "0xc0ad", "0xd801", "0xc7b1", "0xc7b2", "0xc7b4", "0xc7b6", "0xc7b8", "0xc7b9",
  "0xc7bb", "0xc012", "0xc013", "0xc015", "0xc003", "0xc005", "0xc007", "0xc008",
  "0xc00a", "0xc00c", "0xc00d", "0xc018", "0xc019", "0xc01a", "0xc01c", "0xc7be",
  "0xc7c0", "0xc7c3", "0xc7c4", "0xc7c5", "0xc425", "0xc426", "0xc428", "0xc42a",
  "0xc42b", "0xc42c", "0xc42f", "0xc430", "0xc432", "0xc43d", "0xc43e", "0xc43f",
  "0xc440", "0xc441", "0xc442", "0xc443", "0xc444", "0xc445", "0xc0b0", "0xc0b1",
  "0xc447", "0xc44a", "0xc483", "0xc484", "0xc485", "0xc488", "0xc489", "0xc48b",
  "0xc48c", "0xc48d", "0xc490", "0xc491", "0xc492", "0xc493", "0xc494", "0xc496",
  "0xc498", "0xc499", "0xc49a", "0xc44d", "0xc450", "0xc453", "0xc0d1", "0xc0d2",
  "0xc0c6", "0xc7af", "0xc7b0", "0xc24f", "0xc252", "0xc253", "0xc255", "0xc01f",
  "0xc020", "0xc022", "0xc025", "0xc027", "0xc02a", "0xc02b", "0xc02c", "0xc02e",
  "0xc258", "0xc25a", "0xc25d", "0xc25f", "0xc262", "0xc263", "0xc2a6", "0xc2a7",
  "0xc2aa", "0xc2b9", "0xc2ba", "0xc2bc", "0xc2ca", "0xc2c0", "0xc2c1", "0xc2c2",
  "0xc2c4", "0xc2c7", "0xc2cc", "0xc2cd", "0xc2d0", "0xc2df", "0xc2e0", "0xc2e2",
  "0xc2e5", "0xc2e6", "0xc2e7", "0xc2e9", "0xc2ec", "0xc2ed", "0xc2f0", "0xc2fc",
  "0xc2fd", "0xc300", "0xc302", "0xc304", "0xc305", "0xc306", "0xc308", "0xc30b",
  "0xc30c", "0xc30f", "0xc319", "0xc31a", "0xc31d", "0xc31e", "0xc31f", "0xc320",
  "0xc321", "0xc322", "0xc324", "0xc325", "0xc328", "0xc329", "0xc32a", "0xc32c",
  "0xc32d", "0xc330", "0xc337", "0xc338", "0xc33b", "0xc33c", "0xc33d", "0xc33e",
  "0xc33f", "0xc342", "0xc343", "0xc344", "0xc347", "0xc348", "0xc34a", "0xc34b",
  "0xc34d", "0xc34e", "0xc350", "0xc353", "0xc356", "0xc1f9", "0xc1fb", "0xc1fc",
  "0xc1fe", "0xc200", "0xc201", "0xc203", "0xc205", "0xc206", "0xc208", "0xc20a",
  "0xc20b", "0xc20d", "0xc359", "0xc18b", "0xc0ba", "0xc0bb", "0xc0bd", "0xc0c0",
  "0xc0c1", "0xc18e", "0xc18f", "0xc199", "0xc19a", "0xc19c", "0xc26b", "0xc26e",
  "0xc26f", "0xc276", "0xc277", "0xc27a", "0xc27d", "0xc27e", "0xc280", "0xc272",
  "0xc273", "0xc7c8", "0xc7cb", "0xc7d4", "0xc7ce", "0xc7d0", "0xc7d2"
]

internal func pyBoyBlarggCpuInstrs01() {
  let cartridge = Helpers.openRom(url: cpuInstrs01special)
  let gameBoy   = GameBoy(bootrom: .skip, cartridge: cartridge)
  let debugger  = Debugger(gameBoy: gameBoy)

  let currentFile = URL(fileURLWithPath: #file)
  let mainDir     = currentFile.deletingLastPathComponent()
  let pyDir = mainDir.appendingPathComponent("PyBlarggFiles01")

  for (index, pc) in programCounters.enumerated() {
    let fileName = "pyboy_01_special_pc_\(pc).txt"
    print("\(index) - \(fileName)")

    let fileUrl = pyDir.appendingPathComponent(fileName)
    let pyBoy = pyLoad(fileUrl)

    debugger.run(mode: .none, lastPC: pyBoy.cpu.pc)
    let hasError = pyTest(pyBoy: pyBoy, swiftBoy: gameBoy)

    if hasError {
      fatalError("Blargg - cpu instrs 01 - error on \(fileName)")
    }
  }

  print("Finished Blargg - cpu instrs 01")
}
